<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ä¸­è‹±æ–‡å•è¯æ¶ˆæ¶ˆä¹</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <style>
    /* ===== åŸºç¡€å¸ƒå±€ä¸æ’ç‰ˆ ===== */
    :root {
      --bg-color: #f5f7fb;
      --bg-color-soft: #eef2fa;
      --card-bg: #ffffff;
      --card-text-color: #222222;
      --accent-color: #4a90e2;
      --accent-soft: #8ab4f8;
      --accent-strong: #2f6bc5;
      --danger-color: #e57373;
      --text-secondary: #666a78;
      --border-radius: 18px;
      --card-shadow: 0 8px 20px rgba(15, 35, 80, 0.08);
      --card-shadow-strong: 0 10px 26px rgba(15, 35, 80, 0.16);
      --transition-fast: 0.16s ease-out;
      --transition-med: 0.25s ease-out;
      --card-en-bg: linear-gradient(145deg, #fdfdff, #e3f0ff);
      --card-zh-bg: linear-gradient(145deg, #fefcf7, #f4efe2);
      --card-en-text: #1c2838;
      --card-zh-text: #33251a;
      --card-border-color: rgba(0, 0, 0, 0.04);
    }

    body.skin-red {
      --bg-color: #fff5f5;
      --bg-color-soft: #ffe4e4;
      --card-bg: #ffffff;
      --card-text-color: #3b1c1c;
      --accent-color: #e85b5b;
      --accent-soft: #f5a3a3;
      --accent-strong: #d72f4b;
      --text-secondary: #7b4b4b;
      --card-shadow: 0 8px 20px rgba(170, 60, 60, 0.18);
      --card-shadow-strong: 0 10px 26px rgba(170, 60, 60, 0.28);
      --card-en-bg: linear-gradient(145deg, #fff0f2, #ffd5dc);
      --card-zh-bg: linear-gradient(145deg, #fff9f5, #ffe5dd);
      --card-en-text: #3b151b;
      --card-zh-text: #3b1c1c;
      --card-border-color: rgba(220, 120, 135, 0.4);
    }

    body.skin-orange {
      --bg-color: #fff7ec;
      --bg-color-soft: #ffe7cc;
      --card-bg: #fffdf7;
      --card-text-color: #3b2614;
      --accent-color: #f29b4b;
      --accent-soft: #f6bf7a;
      --accent-strong: #e6762b;
      --text-secondary: #8a6440;
      --card-shadow: 0 8px 20px rgba(196, 124, 56, 0.18);
      --card-shadow-strong: 0 10px 26px rgba(196, 124, 56, 0.3);
      --card-en-bg: linear-gradient(145deg, #fff3e0, #ffd9ae);
      --card-zh-bg: linear-gradient(145deg, #fff9ec, #ffe7c6);
      --card-en-text: #3d2712;
      --card-zh-text: #3b2614;
      --card-border-color: rgba(220, 150, 90, 0.42);
    }

    body.skin-yellow {
      --bg-color: #fffbe6;
      --bg-color-soft: #fff3b8;
      --card-bg: #fffef5;
      --card-text-color: #3a3214;
      --accent-color: #f2c94c;
      --accent-soft: #ffe27a;
      --accent-strong: #e0a81f;
      --text-secondary: #85763a;
      --card-shadow: 0 8px 20px rgba(191, 153, 40, 0.16);
      --card-shadow-strong: 0 10px 26px rgba(191, 153, 40, 0.26);
      --card-en-bg: linear-gradient(145deg, #fff9da, #ffeaa8);
      --card-zh-bg: linear-gradient(145deg, #fffdf0, #fff0c4);
      --card-en-text: #3b3214;
      --card-zh-text: #3a3214;
      --card-border-color: rgba(210, 175, 60, 0.4);
    }

    body.skin-green {
      --bg-color: #eaf7f0;
      --bg-color-soft: #d6f0e1;
      --card-bg: #f7fffa;
      --card-text-color: #163526;
      --accent-color: #36a56a;
      --accent-soft: #79c894;
      --accent-strong: #248251;
      --text-secondary: #4b6a57;
      --card-shadow: 0 8px 20px rgba(43, 124, 82, 0.16);
      --card-shadow-strong: 0 10px 26px rgba(43, 124, 82, 0.26);
      --card-en-bg: linear-gradient(145deg, #e4f7ea, #c9eed8);
      --card-zh-bg: linear-gradient(145deg, #f3fff7, #ddf5e6);
      --card-en-text: #123524;
      --card-zh-text: #163526;
      --card-border-color: rgba(60, 140, 90, 0.38);
    }

    body.skin-cyan {
      --bg-color: #e7f7fa;
      --bg-color-soft: #d0edf5;
      --card-bg: #f7feff;
      --card-text-color: #11323b;
      --accent-color: #36a3c8;
      --accent-soft: #7cc7e1;
      --accent-strong: #1f7ea0;
      --text-secondary: #476373;
      --card-shadow: 0 8px 20px rgba(46, 124, 148, 0.16);
      --card-shadow-strong: 0 10px 26px rgba(46, 124, 148, 0.28);
      --card-en-bg: linear-gradient(145deg, #e3f7ff, #c8ebf7);
      --card-zh-bg: linear-gradient(145deg, #f5fdff, #ddf4fb);
      --card-en-text: #10323c;
      --card-zh-text: #11323b;
      --card-border-color: rgba(70, 140, 165, 0.4);
    }

    body.skin-blue {
      --bg-color: #f1f5ff;
      --bg-color-soft: #dde7ff;
      --card-bg: #ffffff;
      --card-text-color: #1f2435;
      --accent-color: #4a7ef2;
      --accent-soft: #8fb0ff;
      --accent-strong: #315ed4;
      --text-secondary: #606782;
      --card-shadow: 0 8px 20px rgba(45, 72, 160, 0.16);
      --card-shadow-strong: 0 10px 26px rgba(45, 72, 160, 0.26);
      --card-en-bg: linear-gradient(145deg, #ecf2ff, #d0ddff);
      --card-zh-bg: linear-gradient(145deg, #f8f9ff, #e5ecff);
      --card-en-text: #1f2435;
      --card-zh-text: #262b3a;
      --card-border-color: rgba(90, 120, 210, 0.38);
    }

    body.skin-purple {
      --bg-color: #f6f1ff;
      --bg-color-soft: #e5d6ff;
      --card-bg: #fdfbff;
      --card-text-color: #271a3b;
      --accent-color: #8a5ae6;
      --accent-soft: #b191f4;
      --accent-strong: #6b3ac5;
      --text-secondary: #75608f;
      --card-shadow: 0 8px 20px rgba(104, 73, 170, 0.18);
      --card-shadow-strong: 0 10px 26px rgba(104, 73, 170, 0.28);
      --card-en-bg: linear-gradient(145deg, #f1e7ff, #e0d0ff);
      --card-zh-bg: linear-gradient(145deg, #faf5ff, #ecddff);
      --card-en-text: #291a3d;
      --card-zh-text: #2b1d40;
      --card-border-color: rgba(120, 90, 190, 0.4);
    }

    body.skin-gray {
      --bg-color: #f4f5f7;
      --bg-color-soft: #e1e4ea;
      --card-bg: #ffffff;
      --card-text-color: #22242b;
      --accent-color: #7b8ba3;
      --accent-soft: #a2afc3;
      --accent-strong: #5b6577;
      --text-secondary: #6d7280;
      --card-shadow: 0 8px 20px rgba(60, 72, 88, 0.14);
      --card-shadow-strong: 0 10px 26px rgba(60, 72, 88, 0.22);
      --card-en-bg: linear-gradient(145deg, #f1f3f7, #dde1ea);
      --card-zh-bg: linear-gradient(145deg, #fbfcfe, #e8ebf2);
      --card-en-text: #22242b;
      --card-zh-text: #262831;
      --card-border-color: rgba(120, 130, 145, 0.32);
    }

    body.skin-black {
      --bg-color: #060712;
      --bg-color-soft: #111525;
      --card-bg: #191e30;
      --card-text-color: #f3f4ff;
      --accent-color: #5b8dff;
      --accent-soft: #4fd1c5;
      --accent-strong: #7f9bff;
      --text-secondary: #9da4c7;
      --card-shadow: 0 10px 28px rgba(0, 0, 0, 0.7);
      --card-shadow-strong: 0 14px 40px rgba(0, 0, 0, 0.85);
      --card-en-bg: linear-gradient(145deg, #212840, #151a2b);
      --card-zh-bg: linear-gradient(145deg, #191f32, #111523);
      --card-en-text: #f5f6ff;
      --card-zh-text: #ecefff;
      --card-border-color: rgba(140, 160, 255, 0.5);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.85), rgba(0,0,0,0)) , var(--bg-color);
      color: var(--card-text-color);
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 10px 12px;
      min-height: 100vh;
    }

    @media (min-width: 768px) {
      .app {
        padding: 16px 20px 20px;
      }
    }

    /* ===== é¡¶éƒ¨æ§åˆ¶åŒº ===== */
    .top-bar {
      border-radius: 18px;
      padding: 10px 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      box-shadow: 0 14px 40px rgba(15, 35, 80, 0.06);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      backdrop-filter: blur(12px);
    }

    body.skin-black .top-bar {
      background: linear-gradient(135deg, rgba(10,10,20,0.95), rgba(30,30,60,0.85));
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.45);
    }
    body.skin-black .top-bar * {
      color: #e5e7f5;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin-right: 12px;
    }

    .title-main {
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .title-sub {
      font-size: 0.78rem;
      color: var(--text-secondary);
    }

    .control-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      flex: 1;
      align-items: center;
      justify-content: flex-end;
    }

    .control-group {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--bg-color-soft);
      border-radius: 999px;
      padding: 4px 8px;
    }

    body.skin-night .control-group {
      background: rgba(15, 20, 40, 0.9);
    }

    .control-label {
      font-size: 0.78rem;
      color: var(--text-secondary);
    }

    select, button {
      font-family: inherit;
    }

    .select {
      border-radius: 999px;
      border: none;
      padding: 4px 10px;
      font-size: 0.8rem;
      background: #ffffff;
      color: var(--card-text-color);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
      cursor: pointer;
    }
    body.skin-night .select {
      background: #1b2033;
      color: #e5e7f5;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: 0.02em;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), color var(--transition-fast), opacity var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-strong));
      color: #ffffff;
      box-shadow: 0 10px 30px rgba(15, 35, 80, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 34px rgba(15, 35, 80, 0.4);
    }

    .btn-pill {
      background: rgba(255,255,255,0.9);
      color: var(--card-text-color);
      box-shadow: 0 6px 14px rgba(0,0,0,0.06);
    }

    body.skin-night .btn-pill {
      background: #20263a;
      color: #e5e7f5;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    }

    .btn-pill.active {
      background: var(--accent-color);
      color: #ffffff;
      box-shadow: 0 8px 20px rgba(15, 35, 80, 0.6);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      padding: 4px 10px;
      box-shadow: none;
    }

    .btn-ghost.on {
      color: var(--accent-color);
      font-weight: 700;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 18px rgba(0,0,0,0.16);
    }

    .skins {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 3px 4px;
      border-radius: 12px;
      background: rgba(255,255,255,0.9);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
      max-width: 260px;
    }
    body.skin-black .skins {
      background: rgba(10,10,20,0.9);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
    }

    .skin-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      padding: 2px 7px 2px 3px;
      background: rgba(255,255,255,0.9);
      font-size: 0.72rem;
      color: var(--card-text-color);
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }

    .skin-item-label {
      white-space: nowrap;
    }

    .skin-item.active {
      border-color: var(--accent-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.16);
    }

    .skin-swatch {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.8), 0 0 0 2px rgba(0,0,0,0.02);
    }

    .skin-swatch.red {
      background: linear-gradient(135deg, #ffd6d6, #f06a6a);
    }
    .skin-swatch.orange {
      background: linear-gradient(135deg, #ffe0c2, #f29b4b);
    }
    .skin-swatch.yellow {
      background: linear-gradient(135deg, #fff2b8, #f2c94c);
    }
    .skin-swatch.green {
      background: linear-gradient(135deg, #ccefdc, #36a56a);
    }
    .skin-swatch.cyan {
      background: linear-gradient(135deg, #c6edf7, #36a3c8);
    }
    .skin-swatch.blue {
      background: linear-gradient(135deg, #d8e4ff, #4a7ef2);
    }
    .skin-swatch.purple {
      background: linear-gradient(135deg, #e4d6ff, #8a5ae6);
    }
    .skin-swatch.gray {
      background: linear-gradient(135deg, #e2e4ea, #7b8ba3);
    }
    .skin-swatch.black {
      background: radial-gradient(circle at 30% 20%, #4c5bff, #050612);
    }

    @media (max-width: 720px) {
      .top-bar {
        align-items: flex-start;
      }
      .control-row {
        justify-content: flex-start;
      }
    }

    /* ===== ä¸»æ¸¸æˆåŒºåŸŸ ===== */
    .game-area {
      flex: 1;
      margin-top: 12px;
      border-radius: 20px;
      padding: 12px 10px 10px;
      background: radial-gradient(circle at top right, rgba(255,255,255,0.86), rgba(255,255,255,0.7));
      box-shadow: 0 16px 50px rgba(15, 35, 80, 0.09);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-height: 0;
      overflow: hidden;
    }

    body.skin-black .game-area {
      background: radial-gradient(circle at top right, rgba(255,255,255,0.03), rgba(0,0,0,0.65));
      box-shadow: 0 18px 60px rgba(0,0,0,0.75);
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      grid-auto-rows: 1fr;
      gap: 12px;
      width: min(900px, 92vw);
      aspect-ratio: 4 / 6;
      max-height: calc(100vh - 170px);
      padding: 8px;
    }

    .hint {
      font-size: 0.86rem;
      color: var(--text-secondary);
      text-align: center;
      padding-top: 18px;
    }

    .hint small {
      display: block;
      margin-top: 4px;
      opacity: 0.9;
    }

    /* ===== å¡ç‰‡æ ·å¼ ===== */
    .card {
      cursor: pointer;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      padding: 10px 8px;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 80px;
      border: 1px solid var(--card-border-color);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-med), opacity var(--transition-med), filter var(--transition-fast);
      will-change: transform, box-shadow, opacity;
      user-select: none;
    }

    @media (min-width: 768px) {
      .card {
        min-height: 96px;
        padding: 14px 10px;
      }
    }

    .card-inner {
      text-align: center;
      padding: 4px 4px;
    }

    .card-text-en {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .card-text-zh {
      font-size: 1rem;
      font-weight: 600;
    }

    .card-en {
      background: var(--card-en-bg);
      color: var(--card-en-text);
    }

    .card-zh {
      background: var(--card-zh-bg);
      color: var(--card-zh-text);
    }

    .card:hover {
      transform: translateY(-1px);
      box-shadow: var(--card-shadow-strong);
    }

    .card.selected {
      box-shadow: var(--card-shadow-strong);
      transform: translateY(-2px);
      filter: brightness(1.05);
    }

    .card.speaking {
      outline: 2px solid var(--accent-strong);
      outline-offset: -2px;
    }

    .card.matched,
    .card.card-hidden {
      pointer-events: none;
      opacity: 0;
    }

    .card.shake {
      animation: shake 0.25s ease-out;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      50% { transform: translateX(3px); }
      75% { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }

    /* ===== åº•éƒ¨ä¿¡æ¯æ  ===== */
    .bottom-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--text-secondary);
      padding: 0 3px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .stats {
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }

    .dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: var(--accent-color);
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.04);
      color: var(--card-text-color);
    }

    body.skin-night .badge {
      background: rgba(255,255,255,0.1);
      color: #e5e7f5;
    }

    /* ===== é€šå…³é®ç½©ä¸çƒŸèŠ±ç”»å¸ƒ ===== */
    .overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.35s ease-out;
      z-index: 20;
    }

    .overlay.active {
      pointer-events: auto;
      opacity: 1;
    }

    .overlay-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
      backdrop-filter: blur(6px);
    }

    .overlay-content {
      position: relative;
      z-index: 1;
      background: rgba(255,255,255,0.96);
      border-radius: 22px;
      padding: 20px 18px 16px;
      text-align: center;
      box-shadow: 0 18px 60px rgba(0,0,0,0.4);
      max-width: 320px;
      width: 82vw;
    }

    body.skin-black .overlay-content {
      background: rgba(12, 16, 30, 0.98);
      color: #f9fafb;
    }

    .overlay-title {
      font-size: 1.35rem;
      margin-bottom: 4px;
    }

    .overlay-text {
      font-size: 0.86rem;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }

    .overlay-btn {
      margin-top: 6px;
      width: 100%;
    }

    .fireworks-canvas {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 15;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 480px) {
      .title-main {
        font-size: 0.95rem;
      }
      .card-text-en {
        font-size: 0.95rem;
      }
      .card-text-zh {
        font-size: 0.84rem;
      }
      .game-area {
        padding: 10px 8px 8px;
      }
    }
  </style>
</head>
<body class="skin-blue">
  <!-- é¡¶éƒ¨æ§åˆ¶åŒº -->
  <div class="app">
    <header class="top-bar">
      <div class="title-block">
        <div class="title-main">ä¸­è‹±æ–‡å•è¯æ¶ˆæ¶ˆä¹</div>
        <div class="title-sub">ç‚¹å‡»è‹±æ–‡å‘éŸ³ï¼ŒåŒ¹é…å¯¹åº”ä¸­æ–‡é‡Šä¹‰</div>
      </div>
      <div class="control-row">
        <div class="control-group">
          <span class="control-label">è¯åº“</span>
          <select id="category-select" class="select">
            <option value="junior">åˆä¸­è‹±è¯­</option>
            <option value="senior">é«˜ä¸­è‹±è¯­</option>
            <option value="it">IT è‹±è¯­</option>
            <option value="abroad">å‡ºå›½è‹±è¯­</option>
            <option value="phrase">å¸¸ç”¨è‹±è¯­çŸ­è¯­</option>
          </select>
        </div>

        <div class="control-group">
          <span class="control-label">æœ¬å±€è¯å¯¹</span>
          <select id="pair-count-select" class="select">
            <option value="8">8 å¯¹ï¼ˆè½»æ¾ï¼‰</option>
            <option value="12">12 å¯¹ï¼ˆæ ‡å‡†ï¼‰</option>
            <option value="16">16 å¯¹ï¼ˆæŒ‘æˆ˜ï¼‰</option>
          </select>
        </div>

        <div class="control-group">
          <span class="control-label">çš®è‚¤</span>
          <div class="skins" id="skin-group">
            <button class="skin-item" data-skin="red">
              <span class="skin-swatch red"></span>
              <span class="skin-item-label">èµ¤</span>
            </button>
            <button class="skin-item" data-skin="orange">
              <span class="skin-swatch orange"></span>
              <span class="skin-item-label">æ©™</span>
            </button>
            <button class="skin-item" data-skin="yellow">
              <span class="skin-swatch yellow"></span>
              <span class="skin-item-label">é»„</span>
            </button>
            <button class="skin-item" data-skin="green">
              <span class="skin-swatch green"></span>
              <span class="skin-item-label">ç»¿</span>
            </button>
            <button class="skin-item" data-skin="cyan">
              <span class="skin-swatch cyan"></span>
              <span class="skin-item-label">é’</span>
            </button>
            <button class="skin-item" data-skin="blue">
              <span class="skin-swatch blue"></span>
              <span class="skin-item-label">è“</span>
            </button>
            <button class="skin-item" data-skin="purple">
              <span class="skin-swatch purple"></span>
              <span class="skin-item-label">ç´«</span>
            </button>
            <button class="skin-item" data-skin="gray">
              <span class="skin-swatch gray"></span>
              <span class="skin-item-label">ç°</span>
            </button>
            <button class="skin-item" data-skin="black">
              <span class="skin-swatch black"></span>
              <span class="skin-item-label">é»‘</span>
            </button>
          </div>
        </div>

        <div class="control-group">
          <button id="toggle-bgm" class="btn btn-ghost">ğŸµ BGM: å¼€</button>
          <button id="toggle-sfx" class="btn btn-ghost">ğŸ”” éŸ³æ•ˆ: å¼€</button>
        </div>

        <button id="start-btn" class="btn btn-primary">
          â–¶ å¼€å§‹ / æ¢ä¸€å±€
        </button>
      </div>
    </header>

    <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
    <main class="game-area">
      <div id="card-container" class="card-grid"></div>
      <div id="empty-hint" class="hint">
        ç‚¹å‡»å³ä¾§ã€Œå¼€å§‹ / æ¢ä¸€å±€ã€ç”Ÿæˆå¡ç‰‡<br/>
        <small>æç¤ºï¼šç‚¹å‡»è‹±æ–‡å¡ç‰‡ä¼šè‡ªåŠ¨å‘éŸ³ï¼Œå†ç‚¹å¯¹åº”çš„ä¸­æ–‡é‡Šä¹‰å®ŒæˆåŒ¹é…</small>
      </div>
    </main>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <footer class="bottom-bar">
      <div class="stats">
        <span class="badge"><span class="dot"></span> æœ¬å±€è¿›åº¦ï¼š<span id="progress-text">0 / 0</span></span>
        <span class="badge">é”™è¯¯æ¬¡æ•°ï¼š<span id="miss-text">0</span></span>
      </div>
      <div class="hint-mini">
        <span class="badge">ğŸ’¡ ç¤ºä¾‹è¯åº“å¯æŒ‰åŒæ ·æ ¼å¼è‡ªè¡Œæ‰©å±•åˆ° 2000+ æ¡</span>
      </div>
    </footer>
  </div>

  <!-- é€šå…³é®ç½©ä¸çƒŸèŠ± -->
  <canvas id="fireworks-canvas" class="fireworks-canvas"></canvas>

  <div id="victory-overlay" class="overlay hidden">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content">
      <div class="overlay-title">æ­å–œå®Œæˆ ğŸ‰</div>
      <div class="overlay-text">æ‰€æœ‰å•è¯éƒ½å·²æˆåŠŸåŒ¹é…ï¼Œç»§ç»­ä¸‹ä¸€å±€å·©å›ºè®°å¿†å§ï¼</div>
      <button id="overlay-restart" class="btn btn-primary overlay-btn">å†æ¥ä¸€å±€</button>
    </div>
  </div>

  <script>
    // ===== è¯åº“å®šä¹‰ï¼ˆç¤ºä¾‹ï¼šå¯æŒ‰åŒæ ·ç»“æ„æ‰©å±•åˆ° 2000+ æ¡ï¼‰ =====
    const WORD_BANKS = {
      // åˆä¸­è‹±è¯­é«˜é¢‘è¯æ±‡
      junior: [
        { en: "apple", zh: "è‹¹æœ" },
        { en: "banana", zh: "é¦™è•‰" },
        { en: "orange", zh: "æ©™å­" },
        { en: "teacher", zh: "è€å¸ˆ" },
        { en: "student", zh: "å­¦ç”Ÿ" },
        { en: "family", zh: "å®¶åº­" },
        { en: "friend", zh: "æœ‹å‹" },
        { en: "classroom", zh: "æ•™å®¤" },
        { en: "notebook", zh: "ç¬”è®°æœ¬" },
        { en: "homework", zh: "å®¶åº­ä½œä¸š" },
        { en: "library", zh: "å›¾ä¹¦é¦†" },
        { en: "weather", zh: "å¤©æ°”" },
        { en: "rainy", zh: "ä¸‹é›¨çš„" },
        { en: "sunny", zh: "æ™´æœ—çš„" },
        { en: "cloudy", zh: "å¤šäº‘çš„" },
        { en: "winter", zh: "å†¬å¤©" },
        { en: "summer", zh: "å¤å¤©" },
        { en: "spring", zh: "æ˜¥å¤©" },
        { en: "autumn", zh: "ç§‹å¤©" },
        { en: "breakfast", zh: "æ—©é¤" },
        { en: "lunch", zh: "åˆé¤" },
        { en: "dinner", zh: "æ™šé¤" },
        { en: "music", zh: "éŸ³ä¹" },
        { en: "sport", zh: "è¿åŠ¨" },
        { en: "basketball", zh: "ç¯®çƒ" },
        { en: "football", zh: "è¶³çƒ" },
        { en: "swim", zh: "æ¸¸æ³³" },
        { en: "read", zh: "é˜…è¯»" },
        { en: "write", zh: "å†™ä½œ" },
        { en: "listen", zh: "å¬" },
        { en: "speak", zh: "è¯´" },
        { en: "today", zh: "ä»Šå¤©" },
        { en: "yesterday", zh: "æ˜¨å¤©" },
        { en: "tomorrow", zh: "æ˜å¤©" },
        { en: "usually", zh: "é€šå¸¸" },
        { en: "often", zh: "ç»å¸¸" },
        { en: "sometimes", zh: "æœ‰æ—¶" },
        { en: "never", zh: "ä»ä¸" },
        { en: "always", zh: "æ€»æ˜¯" },
        { en: "excited", zh: "å…´å¥‹çš„" },
        { en: "happy", zh: "é«˜å…´çš„" },
        { en: "tired", zh: "ç–²å€¦çš„" },
        { en: "hungry", zh: "é¥¥é¥¿çš„" },
        { en: "thirsty", zh: "å£æ¸´çš„" },
        { en: "subject", zh: "å­¦ç§‘" },
        { en: "English", zh: "è‹±è¯­" },
        { en: "math", zh: "æ•°å­¦" },
        { en: "science", zh: "ç§‘å­¦" },
        { en: "history", zh: "å†å²" },
        { en: "geography", zh: "åœ°ç†" },
        { en: "art", zh: "ç¾æœ¯" }
      ],
      // é«˜ä¸­è‹±è¯­è¯æ±‡
      senior: [
        { en: "analyze", zh: "åˆ†æ" },
        { en: "approach", zh: "æ–¹æ³•ï¼›æ¥è¿‘" },
        { en: "argument", zh: "è®ºç‚¹ï¼›äº‰è®º" },
        { en: "concept", zh: "æ¦‚å¿µ" },
        { en: "contrast", zh: "å¯¹æ¯”" },
        { en: "criticism", zh: "æ‰¹è¯„ï¼›è¯„è®º" },
        { en: "evidence", zh: "è¯æ®" },
        { en: "hypothesis", zh: "å‡è®¾" },
        { en: "significant", zh: "é‡è¦çš„ï¼›æ˜¾è‘—çš„" },
        { en: "efficient", zh: "é«˜æ•ˆçš„" },
        { en: "complex", zh: "å¤æ‚çš„" },
        { en: "consequence", zh: "ç»“æœï¼›åæœ" },
        { en: "consumption", zh: "æ¶ˆè´¹ï¼›æ¶ˆè€—" },
        { en: "cooperate", zh: "åˆä½œ" },
        { en: "determine", zh: "å†³å®šï¼›ç¡®å®š" },
        { en: "environment", zh: "ç¯å¢ƒ" },
        { en: "evolution", zh: "è¿›åŒ–ï¼›æ¼”å˜" },
        { en: "globalization", zh: "å…¨çƒåŒ–" },
        { en: "impact", zh: "å½±å“ï¼›å†²å‡»" },
        { en: "maintain", zh: "ç»´æŒï¼›ä¸»å¼ " },
        { en: "migrate", zh: "è¿ç§»" },
        { en: "motivation", zh: "åŠ¨æœº" },
        { en: "opportunity", zh: "æœºä¼š" },
        { en: "perspective", zh: "è§‚ç‚¹ï¼›è§†è§’" },
        { en: "potential", zh: "æ½œåŠ›ï¼›æ½œåœ¨çš„" },
        { en: "procedure", zh: "ç¨‹åºï¼›æ‰‹ç»­" },
        { en: "reaction", zh: "ååº”" },
        { en: "reliable", zh: "å¯é çš„" },
        { en: "significance", zh: "æ„ä¹‰ï¼›é‡è¦æ€§" },
        { en: "strategy", zh: "ç­–ç•¥" },
        { en: "structure", zh: "ç»“æ„" },
        { en: "sufficient", zh: "è¶³å¤Ÿçš„" },
        { en: "sustainable", zh: "å¯æŒç»­çš„" },
        { en: "technology", zh: "æŠ€æœ¯" },
        { en: "trend", zh: "è¶‹åŠ¿" },
        { en: "urbanization", zh: "åŸå¸‚åŒ–" },
        { en: "virtual", zh: "è™šæ‹Ÿçš„ï¼›å‡ ä¹çš„" },
        { en: "participate", zh: "å‚ä¸" },
        { en: "persuade", zh: "è¯´æœ" },
        { en: "guarantee", zh: "ä¿è¯ï¼›æ‹…ä¿" },
        { en: "contrast", zh: "å¯¹æ¯”ï¼›å¯¹ç…§" },
        { en: "illustrate", zh: "è¯´æ˜ï¼›ä¸¾ä¾‹è¯´æ˜" },
        { en: "unique", zh: "ç‹¬ç‰¹çš„" },
        { en: "flexible", zh: "çµæ´»çš„" },
        { en: "curiosity", zh: "å¥½å¥‡å¿ƒ" },
        { en: "concentration", zh: "é›†ä¸­ï¼›ä¸“æ³¨" },
        { en: "efficiently", zh: "é«˜æ•ˆåœ°" },
        { en: "represent", zh: "ä»£è¡¨ï¼›è±¡å¾" },
        { en: "scholarship", zh: "å¥–å­¦é‡‘" },
        { en: "volunteer", zh: "å¿—æ„¿è€…ï¼›å¿—æ„¿" }
      ],
      // IT è‹±è¯­å¸¸ç”¨è¯æ±‡
      it: [
        { en: "algorithm", zh: "ç®—æ³•" },
        { en: "array", zh: "æ•°ç»„" },
        { en: "binary", zh: "äºŒè¿›åˆ¶" },
        { en: "bug", zh: "ç¨‹åºé”™è¯¯" },
        { en: "compile", zh: "ç¼–è¯‘" },
        { en: "debug", zh: "è°ƒè¯•" },
        { en: "database", zh: "æ•°æ®åº“" },
        { en: "deployment", zh: "éƒ¨ç½²" },
        { en: "encryption", zh: "åŠ å¯†" },
        { en: "framework", zh: "æ¡†æ¶" },
        { en: "frontend", zh: "å‰ç«¯" },
        { en: "backend", zh: "åç«¯" },
        { en: "fullstack", zh: "å…¨æ ˆ" },
        { en: "function", zh: "å‡½æ•°" },
        { en: "variable", zh: "å˜é‡" },
        { en: "constant", zh: "å¸¸é‡" },
        { en: "interface", zh: "æ¥å£" },
        { en: "module", zh: "æ¨¡å—" },
        { en: "network", zh: "ç½‘ç»œ" },
        { en: "protocol", zh: "åè®®" },
        { en: "request", zh: "è¯·æ±‚" },
        { en: "response", zh: "å“åº”" },
        { en: "server", zh: "æœåŠ¡å™¨" },
        { en: "client", zh: "å®¢æˆ·ç«¯" },
        { en: "version", zh: "ç‰ˆæœ¬" },
        { en: "virtual machine", zh: "è™šæ‹Ÿæœº" },
        { en: "cloud", zh: "äº‘ï¼›äº‘è®¡ç®—" },
        { en: "container", zh: "å®¹å™¨" },
        { en: "microservice", zh: "å¾®æœåŠ¡" },
        { en: "load balancer", zh: "è´Ÿè½½å‡è¡¡" },
        { en: "latency", zh: "å»¶è¿Ÿ" },
        { en: "bandwidth", zh: "å¸¦å®½" },
        { en: "open source", zh: "å¼€æº" },
        { en: "repository", zh: "ä»£ç ä»“åº“" },
        { en: "branch", zh: "åˆ†æ”¯" },
        { en: "merge", zh: "åˆå¹¶" },
        { en: "commit", zh: "æäº¤" },
        { en: "rollback", zh: "å›æ»š" },
        { en: "cache", zh: "ç¼“å­˜" },
        { en: "session", zh: "ä¼šè¯" },
        { en: "cookie", zh: "Cookieï¼ˆå°å‹æ•°æ®ï¼‰" },
        { en: "authentication", zh: "è®¤è¯" },
        { en: "authorization", zh: "æˆæƒ" },
        { en: "encryption key", zh: "åŠ å¯†å¯†é’¥" },
        { en: "hash", zh: "å“ˆå¸Œ" },
        { en: "scalability", zh: "å¯æ‰©å±•æ€§" },
        { en: "high availability", zh: "é«˜å¯ç”¨" },
        { en: "concurrency", zh: "å¹¶å‘" },
        { en: "thread", zh: "çº¿ç¨‹" },
        { en: "performance", zh: "æ€§èƒ½" }
      ],
      // å‡ºå›½è‹±è¯­è¯æ±‡
      abroad: [
        { en: "boarding pass", zh: "ç™»æœºç‰Œ" },
        { en: "passport", zh: "æŠ¤ç…§" },
        { en: "visa", zh: "ç­¾è¯" },
        { en: "customs", zh: "æµ·å…³" },
        { en: "security check", zh: "å®‰æ£€" },
        { en: "departure", zh: "å‡ºå‘" },
        { en: "arrival", zh: "åˆ°è¾¾" },
        { en: "flight", zh: "èˆªç­" },
        { en: "gate", zh: "ç™»æœºå£" },
        { en: "baggage claim", zh: "è¡Œææå–å¤„" },
        { en: "carry-on luggage", zh: "éšèº«è¡Œæ" },
        { en: "accommodation", zh: "ä½å®¿" },
        { en: "reservation", zh: "é¢„è®¢" },
        { en: "check in", zh: "åŠç†å…¥ä½" },
        { en: "check out", zh: "é€€æˆ¿" },
        { en: "currency exchange", zh: "è´§å¸å…‘æ¢" },
        { en: "credit card", zh: "ä¿¡ç”¨å¡" },
        { en: "tip", zh: "å°è´¹" },
        { en: "tourist attraction", zh: "æ—…æ¸¸æ™¯ç‚¹" },
        { en: "museum", zh: "åšç‰©é¦†" },
        { en: "gallery", zh: "ç¾æœ¯é¦†" },
        { en: "subway", zh: "åœ°é“" },
        { en: "bus stop", zh: "å…¬äº¤è½¦ç«™" },
        { en: "ticket office", zh: "å”®ç¥¨å¤„" },
        { en: "lost and found", zh: "å¤±ç‰©æ‹›é¢†å¤„" },
        { en: "pharmacy", zh: "è¯åº—" },
        { en: "emergency", zh: "ç´§æ€¥æƒ…å†µ" },
        { en: "insurance", zh: "ä¿é™©" },
        { en: "appointment", zh: "é¢„çº¦" },
        { en: "doctor", zh: "åŒ»ç”Ÿ" },
        { en: "allergy", zh: "è¿‡æ•" },
        { en: "vegetarian", zh: "ç´ é£Ÿè€…" },
        { en: "receipt", zh: "æ”¶æ®" },
        { en: "discount", zh: "æŠ˜æ‰£" },
        { en: "souvenir", zh: "çºªå¿µå“" },
        { en: "tour guide", zh: "å¯¼æ¸¸" },
        { en: "host family", zh: "å¯„å®¿å®¶åº­" },
        { en: "orientation", zh: "è¿æ–°ä¼šï¼›é€‚åº”æœŸ" },
        { en: "campus", zh: "æ ¡å›­" },
        { en: "dormitory", zh: "å®¿èˆ" },
        { en: "semester", zh: "å­¦æœŸ" },
        { en: "tuition fee", zh: "å­¦è´¹" },
        { en: "scholarship", zh: "å¥–å­¦é‡‘" },
        { en: "certificate", zh: "è¯ä¹¦" },
        { en: "application form", zh: "ç”³è¯·è¡¨" },
        { en: "deadline", zh: "æˆªæ­¢æ—¥æœŸ" },
        { en: "interview", zh: "é¢è¯•" },
        { en: "orientation week", zh: "è¿æ–°å‘¨" },
        { en: "emergency contact", zh: "ç´§æ€¥è”ç³»äºº" },
        { en: "public transportation", zh: "å…¬å…±äº¤é€š" }
      ],
      // å¸¸ç”¨è‹±è¯­çŸ­è¯­
      phrase: [
        { en: "take off", zh: "èµ·é£ï¼›è„±ä¸‹ï¼ˆè¡£ç‰©ï¼‰" },
        { en: "pick up", zh: "æ¥äººï¼›æ¡èµ·ï¼›å­¦ä¼š" },
        { en: "wake up", zh: "é†’æ¥ï¼›å«é†’" },
        { en: "look for", zh: "å¯»æ‰¾" },
        { en: "look after", zh: "ç…§é¡¾" },
        { en: "turn on", zh: "æ‰“å¼€ï¼ˆç”µå™¨ï¼‰" },
        { en: "turn off", zh: "å…³é—­ï¼ˆç”µå™¨ï¼‰" },
        { en: "put on", zh: "ç©¿ä¸Šï¼›ä½©æˆ´" },
        { en: "take care of", zh: "ç…§é¡¾ï¼›å¤„ç†" },
        { en: "pay attention to", zh: "æ³¨æ„ï¼›å…³æ³¨" },
        { en: "in charge of", zh: "è´Ÿè´£ï¼Œä¸»ç®¡" },
        { en: "as soon as", zh: "ä¸€â€¦å°±â€¦" },
        { en: "as well as", zh: "ä»¥åŠï¼›å’Œâ€¦ä¸€æ ·" },
        { en: "in front of", zh: "åœ¨â€¦å‰é¢" },
        { en: "on time", zh: "å‡†æ—¶" },
        { en: "at least", zh: "è‡³å°‘" },
        { en: "by the way", zh: "é¡ºä¾¿è¯´ä¸€ä¸‹" },
        { en: "more or less", zh: "æˆ–å¤šæˆ–å°‘ï¼›å¤§è‡´" },
        { en: "so far", zh: "åˆ°ç›®å‰ä¸ºæ­¢" },
        { en: "no matter", zh: "æ— è®ºï¼Œä¸ç®¡" },
        { en: "kind of", zh: "æœ‰ç‚¹å„¿ï¼›æŸç§" },
        { en: "a couple of", zh: "å‡ ä¸ªï¼›ä¸€å¯¹" },
        { en: "make sure", zh: "ç¡®ä¿" },
        { en: "figure out", zh: "å¼„æ¸…æ¥šï¼›ç†è§£" },
        { en: "get along with", zh: "ä¸â€¦ç›¸å¤„èæ´½" },
        { en: "run out of", zh: "ç”¨å®Œï¼›è€—å°½" },
        { en: "break down", zh: "å‡ºæ•…éšœï¼›å´©æºƒ" },
        { en: "look forward to", zh: "æœŸå¾…ï¼›ç›¼æœ›" },
        { en: "come true", zh: "å®ç°ï¼›æˆçœŸ" },
        { en: "take part in", zh: "å‚åŠ " },
        { en: "according to", zh: "æ ¹æ®ï¼›æŒ‰ç…§" },
        { en: "in order to", zh: "ä¸ºäº†" },
        { en: "as a result", zh: "ç»“æœï¼›å› æ­¤" },
        { en: "in general", zh: "ä¸€èˆ¬æ¥è¯´" },
        { en: "at the same time", zh: "åŒæ—¶" },
        { en: "for example", zh: "ä¾‹å¦‚" },
        { en: "in other words", zh: "æ¢å¥è¯è¯´" },
        { en: "more importantly", zh: "æ›´é‡è¦çš„æ˜¯" },
        { en: "on the other hand", zh: "å¦ä¸€æ–¹é¢" },
        { en: "in my opinion", zh: "åœ¨æˆ‘çœ‹æ¥" },
        { en: "to be honest", zh: "è¯´å®è¯" },
        { en: "as far as I know", zh: "æ®æˆ‘æ‰€çŸ¥" },
        { en: "to some extent", zh: "åœ¨æŸç§ç¨‹åº¦ä¸Š" },
        { en: "come up with", zh: "æå‡ºï¼›æƒ³å‡º" },
        { en: "keep in mind", zh: "è®°ä½ï¼›ç‰¢è®°" },
        { en: "look into", zh: "è°ƒæŸ¥ï¼›ç ”ç©¶" },
        { en: "instead of", zh: "è€Œä¸æ˜¯" },
        { en: "in case", zh: "ä»¥é˜²ï¼›ä¸‡ä¸€" },
        { en: "once in a while", zh: "å¶å°”ï¼›ä¸æ—¶" },
        { en: "make a difference", zh: "äº§ç”Ÿå½±å“ï¼›æœ‰æ‰€ä½œä¸º" }
      ]
    };

    // ===== å…¨å±€çŠ¶æ€ä¸è®¾ç½® =====
    const STORAGE_KEYS = {
      skin: "wm_skin",
      bgm: "wm_bgm",
      sfx: "wm_sfx",
      category: "wm_category",
      pairCount: "wm_pair_count"
    };

    const AVAILABLE_SKINS = ["red","orange","yellow","green","cyan","blue","purple","gray","black"];

    const settings = {
      skin: "blue",
      bgmEnabled: true,
      sfxEnabled: true,
      category: "junior",
      pairCount: 12
    };

    const state = {
      cards: [],
      firstCardEl: null,
      lock: false,
      matchedPairs: 0,
      totalPairs: 0,
      misses: 0,
      gameActive: false,
      fireworksRunning: false,
      fireworksHandle: null,
      fireworksParticles: []
    };

    const dom = {};
    let audioCtx = null;
    let masterGain = null;
    let bgmGain = null;
    let sfxGain = null;
    let bgmSource = null;
    let speechVoice = null;

    document.addEventListener("DOMContentLoaded", init);

    function init() {
      cacheDom();
      loadSettings();
      applySkin(settings.skin);
      bindEvents();
      updateAudioButtons();
      updateSelects();
      updateStats();

      initSpeech();
      initFireworksCanvas();
      window.addEventListener("resize", initFireworksCanvas);

      settings.category = "junior";
      settings.pairCount = 12;
      updateSelects();
      startNewGame();
    }

    // ===== DOM ç¼“å­˜ä¸ç»‘å®š =====
    function cacheDom() {
      dom.cardContainer = document.getElementById("card-container");
      dom.emptyHint = document.getElementById("empty-hint");
      dom.categorySelect = document.getElementById("category-select");
      dom.pairCountSelect = document.getElementById("pair-count-select");
      dom.startBtn = document.getElementById("start-btn");
      dom.toggleBgmBtn = document.getElementById("toggle-bgm");
      dom.toggleSfxBtn = document.getElementById("toggle-sfx");
      dom.skinGroup = document.getElementById("skin-group");
      dom.progressText = document.getElementById("progress-text");
      dom.missText = document.getElementById("miss-text");
      dom.victoryOverlay = document.getElementById("victory-overlay");
      dom.overlayRestart = document.getElementById("overlay-restart");
      dom.fireworksCanvas = document.getElementById("fireworks-canvas");
      dom.fireCtx = dom.fireworksCanvas.getContext("2d");
    }

    function bindEvents() {
      dom.startBtn.addEventListener("click", () => {
        ensureAudioContext();
        startNewGame();
      });

      dom.categorySelect.addEventListener("change", (e) => {
        settings.category = e.target.value;
        saveSettings();
      });

      dom.pairCountSelect.addEventListener("change", (e) => {
        const v = parseInt(e.target.value, 10);
        settings.pairCount = isNaN(v) ? 12 : v;
        saveSettings();
      });

      dom.toggleBgmBtn.addEventListener("click", () => {
        settings.bgmEnabled = !settings.bgmEnabled;
        if (bgmGain) {
          bgmGain.gain.setTargetAtTime(settings.bgmEnabled ? 0.4 : 0, audioCtx.currentTime, 0.05);
        }
        if (settings.bgmEnabled) {
          ensureAudioContext();
          startBgm();
        } else {
          stopBgm();
        }
        updateAudioButtons();
        saveSettings();
      });

      dom.toggleSfxBtn.addEventListener("click", () => {
        settings.sfxEnabled = !settings.sfxEnabled;
        if (sfxGain) {
          sfxGain.gain.setTargetAtTime(settings.sfxEnabled ? 0.9 : 0, audioCtx ? audioCtx.currentTime : 0, 0.02);
        }
        updateAudioButtons();
        saveSettings();
      });

      dom.skinGroup.addEventListener("click", (e) => {
        const btn = e.target.closest(".skin-item");
        if (!btn) return;
        const skin = btn.getAttribute("data-skin");
        if (!skin) return;
        settings.skin = skin;
        applySkin(skin);
        saveSettings();
      });

      dom.overlayRestart.addEventListener("click", () => {
        hideVictoryOverlay();
        startNewGame();
      });

      dom.victoryOverlay.addEventListener("click", (e) => {
        if (e.target === dom.victoryOverlay || e.target.classList.contains("overlay-backdrop")) {
          hideVictoryOverlay();
        }
      });
    }

    // ===== è®¾ç½®å­˜å– =====
    function loadSettings() {
      try {
        let skin = localStorage.getItem(STORAGE_KEYS.skin);
        const bgm = localStorage.getItem(STORAGE_KEYS.bgm);
        const sfx = localStorage.getItem(STORAGE_KEYS.sfx);
        const category = localStorage.getItem(STORAGE_KEYS.category);
        const pairCount = localStorage.getItem(STORAGE_KEYS.pairCount);

        if (skin) {
          const legacyMap = { fresh: "blue", forest: "green", night: "black", sand: "orange" };
          const mapped = legacyMap[skin] || skin;
          if (AVAILABLE_SKINS.indexOf(mapped) !== -1) {
            settings.skin = mapped;
          }
        }
        if (bgm === "off") settings.bgmEnabled = false;
        if (sfx === "off") settings.sfxEnabled = false;
        if (category && WORD_BANKS[category]) settings.category = category;
        if (pairCount) {
          const v = parseInt(pairCount, 10);
          if (!isNaN(v)) settings.pairCount = v;
        }
      } catch (err) {
        console.warn("è¯»å–è®¾ç½®å¤±è´¥ï¼š", err);
      }
    }

    function saveSettings() {
      try {
        localStorage.setItem(STORAGE_KEYS.skin, settings.skin);
        localStorage.setItem(STORAGE_KEYS.bgm, settings.bgmEnabled ? "on" : "off");
        localStorage.setItem(STORAGE_KEYS.sfx, settings.sfxEnabled ? "on" : "off");
        localStorage.setItem(STORAGE_KEYS.category, settings.category);
        localStorage.setItem(STORAGE_KEYS.pairCount, String(settings.pairCount));
      } catch (err) {
        console.warn("ä¿å­˜è®¾ç½®å¤±è´¥ï¼š", err);
      }
    }

    function applySkin(skin) {
      document.body.classList.remove(
        "skin-red",
        "skin-orange",
        "skin-yellow",
        "skin-green",
        "skin-cyan",
        "skin-blue",
        "skin-purple",
        "skin-gray",
        "skin-black"
      );
      document.body.classList.add("skin-" + skin);
      if (dom.skinGroup) {
        Array.from(dom.skinGroup.querySelectorAll(".skin-item")).forEach((el) => {
          el.classList.toggle("active", el.getAttribute("data-skin") === skin);
        });
      }
    }

    function updateAudioButtons() {
      dom.toggleBgmBtn.textContent = (settings.bgmEnabled ? "ğŸµ BGM: å¼€" : "ğŸµ BGM: å…³");
      dom.toggleSfxBtn.textContent = (settings.sfxEnabled ? "ğŸ”” éŸ³æ•ˆ: å¼€" : "ğŸ”” éŸ³æ•ˆ: å…³");
    }

    function updateSelects() {
      dom.categorySelect.value = settings.category;
      dom.pairCountSelect.value = String(settings.pairCount);
    }

    // ===== æ¸¸æˆé€»è¾‘ï¼šåˆ›å»ºä¸åŒ¹é… =====
    function startNewGame() {
      const bank = WORD_BANKS[settings.category] || [];
      if (!bank.length) return;

      state.gameActive = true;
      state.matchedPairs = 0;
      state.misses = 0;
      state.firstCardEl = null;
      state.lock = false;

      // éšæœºæŠ½å–éœ€è¦çš„è¯å¯¹
      const maxPairs = Math.min(settings.pairCount, bank.length);
      const pool = bank.slice();
      shuffle(pool);
      const selected = pool.slice(0, maxPairs);
      state.totalPairs = selected.length;

      renderCards(selected);
      updateStats();
      dom.emptyHint.classList.add("hidden");

      if (settings.bgmEnabled) {
        ensureAudioContext();
        startBgm();
      }
    }

    function renderCards(pairs) {
      dom.cardContainer.innerHTML = "";
      state.cards = [];

      const temp = [];
      pairs.forEach((item, index) => {
        const id = settings.category + "_" + index + "_" + item.en;
        temp.push({
          id,
          type: "en",
          en: item.en,
          zh: item.zh
        });
        temp.push({
          id,
          type: "zh",
          en: item.en,
          zh: item.zh
        });
      });

      shuffle(temp);

      temp.forEach((cardData) => {
        const cardEl = document.createElement("div");
        cardEl.className = "card card-" + cardData.type;
        cardEl.dataset.id = cardData.id;
        cardEl.dataset.type = cardData.type;
        cardEl.dataset.en = cardData.en;
        cardEl.dataset.zh = cardData.zh;

        const inner = document.createElement("div");
        inner.className = "card-inner";

        if (cardData.type === "en") {
          const main = document.createElement("div");
          main.className = "card-text-en";
          main.textContent = cardData.en;
          inner.appendChild(main);
        } else {
          const main = document.createElement("div");
          main.className = "card-text-zh";
          main.textContent = cardData.zh;
          inner.appendChild(main);
        }

        cardEl.appendChild(inner);
        cardEl.addEventListener("click", () => handleCardClick(cardEl));
        dom.cardContainer.appendChild(cardEl);
        state.cards.push(cardEl);
      });
    }

    function handleCardClick(cardEl) {
      if (!state.gameActive) return;
      if (state.lock) return;
      if (cardEl.classList.contains("matched") || cardEl.classList.contains("card-hidden")) return;
      if (state.firstCardEl === cardEl) return;

      ensureAudioContext();
      playClick();

      const cardType = cardEl.dataset.type;
      const enWord = cardEl.dataset.en;

      if (cardType === "en") {
        speakWord(enWord, cardEl);
      }

      selectCard(cardEl);

      if (!state.firstCardEl) {
        state.firstCardEl = cardEl;
        return;
      }

      // ç¬¬äºŒæ¬¡ç‚¹å‡»è¿›è¡ŒåŒ¹é…åˆ¤æ–­
      const first = state.firstCardEl;
      const second = cardEl;
      state.firstCardEl = null;
      state.lock = true;

      const isMatch =
        first.dataset.id === second.dataset.id &&
        first.dataset.type !== second.dataset.type;

      if (isMatch) {
        playMatch();
        animateMatch([first, second], () => {
          first.classList.add("matched", "card-hidden");
          second.classList.add("matched", "card-hidden");
          state.matchedPairs++;
          updateStats();
          state.lock = false;

          if (state.matchedPairs >= state.totalPairs) {
            onGameComplete();
          }
        });
      } else {
        state.misses++;
        updateStats();
        playError();
        shakeCards([first, second]);
        setTimeout(() => {
          deselectCard(first);
          deselectCard(second);
          state.lock = false;
        }, 320);
      }
    }

    function selectCard(el) {
      el.classList.add("selected");
    }

    function deselectCard(el) {
      el.classList.remove("selected");
      el.classList.remove("speaking");
    }

    function updateStats() {
      dom.progressText.textContent = state.totalPairs
        ? state.matchedPairs + " / " + state.totalPairs
        : "0 / 0";
      dom.missText.textContent = String(state.misses);
    }

    // ===== Web Speech API å‘éŸ³ =====
    function initSpeech() {
      if (!("speechSynthesis" in window)) {
        console.warn("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API");
        return;
      }

      function pickVoice() {
        const voices = window.speechSynthesis.getVoices();
        if (!voices || !voices.length) return;

        const prefer = voices.filter((v) =>
          /^en(-US|-GB)?/i.test(v.lang || "")
        );
        const english = voices.filter((v) =>
          /^en/i.test(v.lang || "")
        );
        speechVoice = prefer[0] || english[0] || null;
      }

      pickVoice();
      if (!speechVoice) {
        window.speechSynthesis.addEventListener("voiceschanged", pickVoice, {
          once: true
        });
      }
    }

    function speakWord(text, cardEl) {
      if (!("speechSynthesis" in window)) return;
      if (!text) return;

      try {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        if (speechVoice) utter.voice = speechVoice;
        utter.lang = "en-US";
        utter.rate = 0.92;
        utter.pitch = 1.02;
        utter.volume = 1.0;

        if (cardEl) {
          cardEl.classList.add("speaking");
          utter.onend = utter.onerror = () => {
            cardEl.classList.remove("speaking");
          };
        }

        window.speechSynthesis.speak(utter);
      } catch (err) {
        console.warn("å‘éŸ³å¤±è´¥ï¼š", err);
      }
    }

    // ===== Web Audioï¼šèƒŒæ™¯éŸ³ä¹ä¸éŸ³æ•ˆ =====
    function ensureAudioContext() {
      if (audioCtx) return;
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (!AudioCtx) {
        console.warn("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Web Audio API");
        return;
      }
      audioCtx = new AudioCtx();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.9;
      masterGain.connect(audioCtx.destination);

      bgmGain = audioCtx.createGain();
      bgmGain.gain.value = settings.bgmEnabled ? 0.4 : 0;
      bgmGain.connect(masterGain);

      sfxGain = audioCtx.createGain();
      sfxGain.gain.value = settings.sfxEnabled ? 0.9 : 0;
      sfxGain.connect(masterGain);
    }

    function playTone(freq, duration, type, gainNode) {
      if (!audioCtx || !gainNode) return;
      if (!settings.sfxEnabled) return;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type || "sine";
      osc.frequency.value = freq;

      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.5, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

      osc.connect(gain).connect(gainNode);
      osc.start(now);
      osc.stop(now + duration + 0.05);
    }

    function playClick() {
      playTone(750, 0.09, "triangle", sfxGain);
    }

    function playMatch() {
      if (!audioCtx || !sfxGain || !settings.sfxEnabled) return;
      playTone(540, 0.12, "sine", sfxGain);
      setTimeout(() => playTone(780, 0.12, "sine", sfxGain), 70);
    }

    function playError() {
      if (!audioCtx || !sfxGain || !settings.sfxEnabled) return;
      playTone(260, 0.18, "sawtooth", sfxGain);
    }

    function playVictory() {
      if (!audioCtx || !sfxGain || !settings.sfxEnabled) return;
      playTone(660, 0.18, "sine", sfxGain);
      setTimeout(() => playTone(880, 0.18, "sine", sfxGain), 120);
      setTimeout(() => playTone(1040, 0.22, "triangle", sfxGain), 260);
      playApplause();
    }

    // ç®€å•é¼“æŒ/å–å½©æ•ˆæœï¼šæ»¤æ³¢ç™½å™ªå£°
    function playApplause() {
      if (!audioCtx || !sfxGain || !settings.sfxEnabled) return;

      const duration = 1.6;
      const sampleRate = audioCtx.sampleRate;
      const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < data.length; i++) {
        const t = i / sampleRate;
        const env = Math.exp(-2.8 * t);
        data[i] = (Math.random() * 2 - 1) * env;
      }

      const src = audioCtx.createBufferSource();
      src.buffer = buffer;

      const filter = audioCtx.createBiquadFilter();
      filter.type = "bandpass";
      filter.frequency.value = 1800;
      filter.Q.value = 1.4;

      const gain = audioCtx.createGain();
      gain.gain.value = 1.2;

      src.connect(filter).connect(gain).connect(sfxGain);
      src.start();
    }

    // èƒŒæ™¯éŸ³ä¹ï¼šæŸ”å’Œå¾ªç¯éŸ³è‰²
    function startBgm() {
      if (!audioCtx || !bgmGain) return;
      if (!settings.bgmEnabled) return;

      // è‹¥å·²å­˜åœ¨ï¼Œåˆ™ä¿æŒå³å¯
      if (bgmSource) return;

      const duration = 6; // ç§’
      const sampleRate = audioCtx.sampleRate;
      const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
      const data = buffer.getChannelData(0);

      // ç”ŸæˆæŸ”å’Œå’Œå¼¦å«åº•éŸ³è‰²
      for (let i = 0; i < data.length; i++) {
        const t = i / sampleRate;
        const base = Math.sin(2 * Math.PI * 220 * t);
        const third = Math.sin(2 * Math.PI * 275 * t);
        const fifth = Math.sin(2 * Math.PI * 330 * t);
        const slow = Math.sin(2 * Math.PI * 0.1 * t) * 0.2 + 0.8; // æ…¢é€Ÿèµ·ä¼

        data[i] = ((base * 0.6 + third * 0.35 + fifth * 0.25) / 1.2) * slow * 0.35;
      }

      const src = audioCtx.createBufferSource();
      src.buffer = buffer;
      src.loop = true;
      src.connect(bgmGain);
      src.start();
      bgmSource = src;
    }

    function stopBgm() {
      if (!bgmSource) return;
      try {
        bgmSource.stop();
      } catch (e) {}
      bgmSource.disconnect();
      bgmSource = null;
    }

    // ===== å¡ç‰‡åŠ¨ç”»ä¸æŠ–åŠ¨ï¼ˆrequestAnimationFrameï¼‰ =====
    function animateMatch(cards, done) {
      const start = performance.now();
      const duration = 260;

      cards.forEach((c) => {
        c.style.willChange = "transform, opacity";
      });

      function frame(now) {
        const t = Math.min(1, (now - start) / duration);
        const pulse = 1 + 0.08 * Math.sin(t * Math.PI);
        const opacity = 1 - t;

        cards.forEach((c) => {
          c.style.transform = "scale(" + pulse + ")";
          c.style.opacity = String(opacity);
        });

        if (t < 1) {
          requestAnimationFrame(frame);
        } else {
          cards.forEach((c) => {
            c.style.transform = "";
            c.style.opacity = "";
            c.classList.add("card-hidden");
            c.style.willChange = "";
          });
          if (typeof done === "function") done();
        }
      }

      requestAnimationFrame(frame);
    }

    function shakeCards(cards) {
      cards.forEach((c) => {
        c.classList.remove("shake");
        void c.offsetWidth;
        c.classList.add("shake");
        c.addEventListener(
          "animationend",
          () => {
            c.classList.remove("shake");
          },
          { once: true }
        );
      });
    }

    // ===== é€šå…³é€»è¾‘ä¸çƒŸèŠ±æ•ˆæœ =====
    function onGameComplete() {
      state.gameActive = false;
      playVictory();
      showVictoryOverlay();
      startFireworks();
    }

    function showVictoryOverlay() {
      dom.victoryOverlay.classList.remove("hidden");
      requestAnimationFrame(() => {
        dom.victoryOverlay.classList.add("active");
      });
    }

    function hideVictoryOverlay() {
      dom.victoryOverlay.classList.remove("active");
      setTimeout(() => {
        dom.victoryOverlay.classList.add("hidden");
      }, 260);
      stopFireworks();
    }

    function initFireworksCanvas() {
      const canvas = dom.fireworksCanvas;
      const dpr = window.devicePixelRatio || 1;
      canvas.width = window.innerWidth * dpr;
      canvas.height = window.innerHeight * dpr;
      dom.fireCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function startFireworks() {
      state.fireworksParticles = [];
      state.fireworksRunning = true;
      const ctx = dom.fireCtx;
      let lastTime = performance.now();

      function spawnFirework() {
        const count = 40 + Math.floor(Math.random() * 20);
        const x = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
        const y = Math.random() * window.innerHeight * 0.5 + window.innerHeight * 0.15;
        const hue = Math.random() * 60 + 200;

        for (let i = 0; i < count; i++) {
          const angle = (Math.PI * 2 * i) / count;
          const speed = 80 + Math.random() * 80;
          state.fireworksParticles.push({
            x,
            y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            life: 1,
            hue: hue + (Math.random() - 0.5) * 30
          });
        }
      }

      function loop(now) {
        if (!state.fireworksRunning) return;
        const dt = Math.min(0.05, (now - lastTime) / 1000);
        lastTime = now;

        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        if (Math.random() < 0.12) {
          spawnFirework();
        }

        const gravity = 200;
        const drag = 0.98;

        for (let i = state.fireworksParticles.length - 1; i >= 0; i--) {
          const p = state.fireworksParticles[i];
          p.vx *= drag;
          p.vy = p.vy * drag + gravity * dt;
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.life -= dt * 0.9;
          if (p.life <= 0) {
            state.fireworksParticles.splice(i, 1);
            continue;
          }
          const alpha = Math.max(0, p.life);
          ctx.beginPath();
          ctx.fillStyle = "hsla(" + p.hue + ", 80%, 60%, " + alpha + ")";
          ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
          ctx.fill();
        }

        state.fireworksHandle = requestAnimationFrame(loop);
      }

      if (!state.fireworksHandle) {
        state.fireworksHandle = requestAnimationFrame(loop);
      }
    }

    function stopFireworks() {
      state.fireworksRunning = false;
      if (state.fireworksHandle) {
        cancelAnimationFrame(state.fireworksHandle);
        state.fireworksHandle = null;
      }
      state.fireworksParticles = [];
      dom.fireCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    }

    // ===== å·¥å…·å‡½æ•° =====
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
</body>
</html>
